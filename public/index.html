<html>
    <head>
        <title>
            LifeTiles
        </title>
        <link type="text/css" rel="stylesheet" href="bootstrap/css/bootstrap.css"></style>
        <link type="text/css" rel="stylesheet" href="css/jqModal.css"></style>
        <style type="text/css">
            body {
                margin:5px;
            }
            img {
                width:200px;
                height:200px;
                overflow:hidden;
            }
            .tile {
                float:left;
                height:200px;
                background-color:#111;
                margin:5px;
                position:relative;
                overflow:hidden;
            }
            .new {
                width:0px;
                overflow:hidden;
            }

            .texthover {
                z-index:1;
                position:absolute;
                display:none;
                background-color:#ccc;
                width:190px;
                padding:5px;
                height:80px;
                bottom:0px;
            }

            .dialog {
                display:none;
                padding:60px;
                margin-bottom:30px;
                background-color:#EEE;
                -webkit-border-radius: 6px;
                -moz-border-radius: 6px;
                border-radius:6px;
                left:50%;
                width:960px;
                margin-left:-540px;
                height:500px;
                top:17%;
                position:fixed;
            }

        </style>
        <script src="holder/holder.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="js/jqModal.js"></script>
        <script type="text/javascript">
            var tiles = [];
            var datums = []

            var highest_id = 0

            function getTiles() {
                $.get("/home/index/" + highest_id, function(r) {
                    r = JSON.parse(r)
                    for (i = 0; i < r.length; i++) {
                        tile = r[i];
                        if (tile["id"] > highest_id) {
                            highest_id = tile.id
                            t = {}
                            t["text"] = tile["description"]
                            t["src"] = tile["image"]
                            tiles.push(t)
                            datums.push(t)
                            console.log("added a tile")
                        }
                    }
                });
            }

            function hoverIn() {
                $(this.children).next(".texthover").attr("style", "display:block;");
            }

            function hoverOut() {
                $(this.children).next(".texthover").attr("style", "display:none;");
            }

            kfade = 500

            function setupDialog(text, img) {
                $("#dialog").html("<p>" + text + "</p><img src='" + img +"'/>")
            }

            function addTile() {
                $(".new").attr("class", "tile");
                if (tiles.length > 0) {
                    tile = tiles.shift();
                    $("body").prepend('<div class="tile new"><img width="200" height="200" src="' + tile["src"] +'"></img><div class="texthover">' + tile["text"] + '</div></div>');
                    $(".new").animate({width:"200px"},kfade);
                    var txt = tile["text"];
                    var img = tile["src"];
                    Holder.run();
                    $(".new").hover(hoverIn, hoverOut);
                    $(".new").click(function(e) {
                        setupDialog(txt,img);
                        $("#dialog").jqmShow();
                    });
                }
            }
            $(document).ready(function() {
                $("#dialog").click(function() {
                    $("#dialog").jqmHide();
                });
                $('#dialog').jqm();
                addTile();
                setInterval(addTile, 2*kfade);
                setInterval(getTiles, 300);
            });
        </script>
    </head>
    <body>
        <div class="dialog" id="dialog">
        </div>
    </body>
</html>
